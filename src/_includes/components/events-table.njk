<section class="mt-md" x-data="eventsTable">
    <h2 class="font-serif text-3xl font-bold leading-none md:text-4xl text-header mb-2xs">Events List</h2>
    {% include 'components/event-table-filter.njk' %}
    {# Testing: <button @click="getFavEvents">load favs</button> #}
    {# TODO: add filter by catagory and sort by name, system, gm, date #}

    <table class="events-table">
        <thead class="hidden sm:table-header-group">
            <tr>
                <th class="text-lg text-left pb-sm">Event</th>
                {# <th class="text-left pb-sm">Date Time</th>
                <th class="text-center pb-sm max-w-max">Dur</th> #}
                <th class="text-left pb-sm">System</th>
                <th class="text-left pb-sm">Categories</th>
                {# <th class="w-8 text-center pb-sm">
                    <span class="flex items-center justify-end pl-xs">{% icon 'square-check', 'fill-body' %}</span>
                </th> #}
                <th class="w-8 text-center pb-sm" x-cloak x-show="isAuth">
                    <span class="fav-star-header"></span>
                </th>
            </tr>
        </thead>
        <tbody>
            {% for event in eventData.events %}
                {# isFav is in Alpine.data("global") #}
                {# build event catagories array for filter button #}
                <tr 
                x-data="{category: [{{event.categoriesAlpineArray}}]}"
                x-show="(filter.category === 'All' || category.includes(filter.category)) && (!filter.favsOnly || isFav({{event.eventId}}))" >

                    {# Event Name #}
                    <td>
                        <h3>
                            <a href="/events/{{event.eventSlug}}" class="font-bold transition-colors text-header hover:text-highlight">{{event.eventName | safe }}</a>
                        </h3>
                        <p>{{event.metadata.GM | safe}}</p>
                    </td>
                    {# Event Start Date/Time #}
                    {# formatEventDate() is in scripts.js and returns html with date and time in seperate span tags #}
                    {# formatEventDate filter is in eleventy.js and returns html with date and time in seperate span tags #}
                    {# <td class="flex flex-col py-sm gap-x-2xs" x-cloak x-show="timezone" x-html="formatEventDate('{{event.eventStartDateTime}}', timezone)">{{ event.eventStartDateTime | formatEventDate | safe }}</td> #}
                    {# Event Duration #}
                    {# <td class="font-bold text-center align-top py-sm px-xs">
                        {% eventDuration event.eventStartDateTime,
                        event.eventEndDateTime %}
                    </td> #}
                    {# System #}
                    <td class="italic">{{event.metadata.System}}</td>
                    {# Event Categories #}
                    <td>
                        <div class="flex flex-wrap mt-2xs sm:mt-0 gap-2xs">
                            {% for category in event.categories %}
                                <span class="text-xs rounded-full px-xs py-[.15rem] bg-card">{{category.name}}</span>
                            {% endfor %}
                        </div>
                    </td>
                    {# Fav Event Icon #}
                    <td x-cloak x-show="isAuth">
                        {# TODO: refactor toggleFav and isFav #}
                        <span @click="toggleFav({{event.eventId}})" class="fav-star" :class="isFav({{event.eventId}}) && 'favved'">{% icon 'star', 'fill-body' %}</span>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
<script type="text/javascript">

    document.addEventListener('alpine:init', () => {
        Alpine.data('eventsTable', function () {
            return {
                filter: this.$persist({favsOnly: false, openOnly: false, category: 'All'})
            }
        })
    })
</script>