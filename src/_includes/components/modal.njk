{% macro authModal() %}
    {# Backdrop #}
    <div x-cloak x-show="(modal)" x-transition 
    class="fixed inset-0 z-40 flex items-center justify-center bg-backdrop" 
    style="backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);"
    >
        {# Modal #}
        <div 
        id="authModal"
        class="transition-all rounded-md shadow h-80 p-base bg-primary" 
        :class="$store.auth.user && 'h-96'"
        style="max-height: 90%; max-width: 90%"
        @click.outside="modal = false">
            {{ login() }}
            {{ spinner() }}
            {{ userInfo() }}
            {{ changePassword() }}
        </div>
    </div>
{% endmacro %}

{# Front Panel Content #}

{# Login Panel #}
{% macro login() %}
    <div x-cloak x-show="!$store.auth.isAuth && modal === 'login'" class="flex flex-col w-64 h-full">
        <h2 class="-mt-1 font-serif text-3xl font-extrabold leading-none text-secondary">Login</h2>
        <form action="post" class="flex flex-col flex-grow my-sm text-body gap-base" @submit.prevent="$store.auth.submitLogin()">
            <div>
                <label for="username" class="text-xs uppercase">User Name</label>
                <input class="w-full" id="username" name="username" required type="text" x-model="$store.auth.username" value=""/>
            </div>
            <div>
                <label for="password" class="text-xs uppercase">Password</label>
                <input class="w-full" id="password" name="password" required type="password" x-model="$store.auth.password" value=""/>
            </div>
            <div>
                <button class="font-bold uppercase transition-colors duration-200 rounded shadow text-form bg-highlight hover:bg-highlight-2 py-xs px-base" type="submit">Login</button>
            </div>
        </form>
        <div class="flex flex-col justify-start text-sm text-body gap-xs">
            {# TODO: get lost password working #}
            <div>
                Can't login? <a href="/contact-us" class="font-bold text-highlight">Contact Us</a>
            </div>
            <div>
                New? <a href="/create-account" class="font-bold text-highlight">Create an Account</a>
            </div>
        </div>
    </div>
{% endmacro %}

{# Change Password Panel #}
{% macro changePassword() %}
    <div x-cloak x-show="$store.auth.isAuth && modal === 'changePassword'" class="flex flex-col w-64 h-full" >
        {# Header #}
        <div class="flex justify-between gap-x-sm">
            <h2 class="flex-grow -mt-1 font-serif text-2xl font-semibold leading-none text-header">
                Change Password
            </h2>
            <div>
                {{ closeBtn() }}
            </div>
        </div>
        <form action="post" class="flex flex-col flex-grow my-sm text-body gap-base" x-data="{newPassword:''}" @submit.prevent="$store.auth.changePassword(newPassword); modal = false" >
            <div>
                <label for="password" class="text-xs uppercase">New Password</label>
                <input class="w-full" id="password" name="password" required type="password" x-model="newPassword" value=""/>
            </div>
            <div>
                <button class="font-bold uppercase transition-colors duration-200 rounded shadow text-form bg-highlight hover:bg-highlight-2 py-xs px-base" type="submit">Submit</button>
            </div>
        </form>
    </div>
{% endmacro %}

{# Loading Spinner. When logging in but user info not yet loaded #}
{% macro spinner() %}
    <div x-cloak x-show="$store.auth.isAuth && !$store.auth.user" class="text-body">Loading...</div>
{% endmacro %}

{# Close button #}
{% macro closeBtn() %}
    <button @click="modal = false" class="flex items-center justify-center border-2 border-solid rounded w-7 h-7 border-body bg-card hover:border-highlight">
        <svg class="w-4 h-4 fill-body hover:fill-highlight">
            <use xlink:href="/static/images/icons.svg#close"></use>
        </svg>
    </button>
{% endmacro %}

{# My Account User Info Panel including My Events. Shown only when logged in #}
{% macro userInfo() %}
    <div class="flex flex-col h-full text-body"
    x-cloak x-show="$store.auth.isAuth && $store.auth.user && modal !== 'changePassword'"  
    >
        {# Header #}
        <div class="flex justify-between gap-x-sm">
            <h2 class="flex-grow -mt-1 font-serif text-3xl font-semibold leading-none text-header gap-base">
                <span x-text="$store.auth.user && $store.auth.user.displayName"></span> (<span x-text="$store.auth.user && $store.auth.user.userNicename"></span>)
            </h2>
            <div>
                {{ closeBtn() }}
            </div>
        </div>
        {# Quota #}
        {# <div class="text-sm mb-sm">
            <strong>Quota Slots Available:</strong>
            <span x-text="$store.auth.availableSlots"></span>]
        </div> #}
        {# My Events #}
        <h3 class="font-serif text-2xl font-semibold text-body">My Events</h3>
        <div class="mb-sm">{% include 'components/timezone-select.njk' %}</div>
        <ul class="flex-grow overflow-y-auto text-sm border-t-2 border-b-2 text-body border-hr py-xs" x-cloak x-show="$store.auth.bookedEvents">
            <template x-for="event in $store.auth.bookedEvents">
                <li class="mb-xs">
                    <h4 class="font-bold">
                        <a :href="(event.isVolunteer) ? '/volunteer/'+ event.eventSlug : '/events/'+ event.eventSlug" class="text-header hover:text-highlight" x-html="event.eventName"></a>
                    </h4>
                    {# Timezone data is in x-data in html #}
                    {# formatEventDate() is in scripts.js and returns html with date and time in seperate span tags #}
                    <p class="text-xs opacity-90" x-cloak x-show="timezone">
                        <span x-html="formatEventDate(event.eventStartDateTime, timezone)"></span> (<span x-text="event.eventDuration"></span> hrs)
                    </p>
                </li>
            </template>
        </ul>

        {# Buttons #}
        <div class="flex pt-base gap-base">
            <button class="button" @click="$store.auth.logout()">Logout</button>
            <button class="button" @click="modal = 'changePassword'">Change Password</button>
        </div>
    </div>
{% endmacro %}