{%- from "components/modal.njk" import authModal -%}

<!doctype html>
<html lang="en" class="min-h-screen" x-data="{timezone: $persist('America/Los_Angeles'), modal: false }">
  {% include 'layouts/html_head.njk' %}
  <body
  data-theme="auto"
  x-data="global"
  class="min-h-screen bg-primary"
  :style="(modal) && 'overflow: hidden; height: 100vh;'"
  >
    <div class="relative z-10 grid min-h-screen shadow page-wrapper">
      {# Header with branding and nav #}
      <div class="header-wrapper">
        {% block header %}{% endblock %}
      </div>
      <div class="relative content-wrapper bg-gradient-to-b from-main-gradient-top to-main-gradient-bottom pb-lg" >
        {# Login / Account Button #}
        <button @click.stop="modal = 'login'" class="absolute top-0 font-bold uppercase transition-all transform border rounded-b cursor-pointer text-form right-base bg-highlight px-base pb-xs pt-md hover:bg-highlight-2 hover:pt-lg border-highlight" 
        x-text="(authToken) ? 'My Account' : 'Login'">Login</button>
        {# Decorative underbrush svg #}
        <div style="-webkit-mask: url(/static/images/underbrush.svg) repeat-x; mask: url(/static/images/underbrush.svg) repeat-x; pointer-events: none;" class="h-10 underbrush bg-primary mb-sm"></div>
        {# Main Content Area. <main> tag should live in content block #}
        {% block content %}{% endblock %}
        {# Add any content footers her e#}
        {% for contentfooter in collections.contentfooter %}
          {% if (contentfooter.data.location === page.fileSlug) %}
            <section class="mx-auto max-w-content p-base">
              <h2 class="font-serif text-4xl font-bold leading-none md:text-5xl text-header mb-base">{{ contentfooter.data.title }}</h2>
              <div class="prose">{{ contentfooter.templateContent | safe }}</div>
            </section>
          {% endif %}
        {% endfor %}
      </div>
    </div>
    {% include 'components/footer.njk' %}
    {# SVG Gradient used for svg icons sprite #}
    {% include 'components/svg-gradient.njk' %}
    {# Extra optional pagebottom code scripts and styles #}
    {% block pagebottom %}{% endblock %}
    {# Model Popup #}
    {{ authModal() }}
    {# Toast Notification #}
    {# data in global #}
    {# TODO: add colors: error, info, success #}
    <div class="fixed z-50 flex justify-center w-full bottom-8"
    x-data="{toast: {msg:'',duration: 6000}}"
    x-cloak x-show="toast.msg" x-transition
    x-init="toast = {msg:'We are having issues with login. Please be patient',duration: 100000}"
    @toast.window="() => { toast = {...toast, ...event.detail}; setTimeout(() => toast.msg = '', toast.duration); }"
    @click.outside="toast.msg = ''; toast.duration = 6000">
      <div class="flex px-3 text-sm font-bold border-4 rounded-lg shadow-lg w-80 border-primary py-sm gap-base" :class="(toast.msg.startsWith('ERROR')) ? 'bg-red-900 text-white' : 'bg-body text-primary'">
        <p x-text="toast.msg" class="flex-grow"></p>
        <div>
          <button @click="toast.msg = ''" class="flex items-center justify-center w-6 h-6 border-2 border-solid rounded border-body bg-primary">
            <svg class="w-3 h-3 fill-body">
              <use xlink:href="/static/images/icons.svg#close"></use>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </body>

</html>