{% extends 'layouts/base.njk' %}

{% block header %}
    {% include 'components/header.njk' %}
{% endblock %}

{% block content %}
    <main id="content">
        <div class="mx-auto rounded-md shadow-md max-w-content p-base px-lg bg-card">
            <h1 class="font-serif text-4xl font-bold leading-none md:text-5xl text-header mb-base">{{title}}</h1>
            <div class="prose">{{ content | safe }}</div>
            <section class="my-base text-body"
                x-data="createAccount"
                x-effect="displayName = (howToDisplay === 'nickname') ? nickname : firstName + ' ' + lastName;">
                <div class="prose" x-cloak x-show="isAuth && user">
                </div>
                {# Account Settings #}
                <form x-cloak x-show="isAuth" 
                data-netlify="true" 
                netlify-honeypot="bot-field"
                data-netlify-recaptcha="true"
                method="POST" 
                name="account-settings"  
                action="/create-account-thank-you"
                @submit.prevent="() => { submit(user); getUserData(); }"
                >
                    <fieldset>
                        <legend>Account Settings</legend>
                        <p>Manage your Go Play NW account passwords, login preferences and recovery methods.
                        </p>
                        <div>
                            <label for="userNicename" class="text-xs uppercase">Username <span class="font-bold text-highlight">*</span></label>
                            <input type="" id="userNicename" name="userNicename" value="" :value="user && user.userNiceName">
                        </div>
                        <div>
                            <label for="userEmail" class="text-xs uppercase">Email <span class="font-bold text-highlight">*</span></label>                        
                            <input class="w-64" id="userEmailCreateAccount" name="userEmail" required type="email" value="" x-model="userEmail" autocapitalize="off" autocorrect="off" spellcheck="false"
                            x-init="formInfo.userEmail = (user && user.Email) || ''; $watch('user', value => formInfo.userEmail = value && value.userEmail)"/>
                            <input type="" id="userEmail" name="userEmail" value="" :value="user && user.userEmail">
                        </div>
                        <div>
                            <label class="text-xs uppercase">Change Password</label>                        
                            <span class="button" @click="modal = 'changePassword'">Change Password</span>
                        </div>
                    </fieldset>
                    <div data-netlify-recaptcha="true"></div>
                    <p class="mt-base">
                        <button type="submit">Save</button>
                    </p>                    
                    </form>
                {# Attendee Profile #}
                    <form x-cloak x-show="isAuth" 
                    data-netlify="true" 
                    netlify-honeypot="bot-field"
                    data-netlify-recaptcha="true"
                    method="POST" 
                    name="attendee-profile"  
                    action="/create-account-thank-you"
                    >
                    <fieldset>
                        <legend>Attendee Profile</legend>
                        <p>Manage your attendee profile. This information is used to support.
                        </p>
                        <div>
                            <label for="userNicename" class="text-xs uppercase">First Name<span class="font-bold text-highlight">*</span></label>                           
                            <input type="" id="userFirstName" name="userFirstName" value="" :value="user && user.firstName" class="w-64" id="firstName" name="firstName" required type="text" x-model="firstName">
                        </div>
                        <div>
                            <label for="userNicename" class="text-xs uppercase">Last Name<span class="font-bold text-highlight">*</span></label>
                            <p class="text-xs text-body mb-sm">This is how your name will be displayed on your badge and online event signups</p>                            
                            <input type="" id="pronouns" name="pronouns" value="" :value="user && user.pronouns">
                        </div>
                            <div>
                                <label for="howToDisplay" class="text-xs uppercase">How to Display Your Name <span class="font-bold text-highlight">*</span></label>
                                <p class="text-xs text-body mb-sm">This is how your name will be displayed on your badge and online event signups</p>
                                <select class="w-64" id="howToDisplay" name="howToDisplay" required x-model="howToDisplay" value="">
                                    <option value="firstlast" default>Use my first and last</option>
                                    <option value="nickname">For privacy/safety reasons use another name</option>
                                </select>
                            </div>
                            <div x-cloak x-show="howToDisplay === 'nickname'">
                                <label for="nickname" class="text-xs uppercase">Publically Displayed Name <span class="font-bold text-highlight">*</span></label>
                                <input class="w-64" id="nickname" name="nickname" :required="howToDisplay === 'nickname'" type="text" x-model="nickname" value=""/>
                            </div>
                            <input type="hidden" value="" name="displayName" id="displayName" :value="displayName"/>
                            <input type="hidden" value="create-account" name="formName" id="formName"/>
                        <div>
                            <label for="userNicename" class="text-xs uppercase">Badge Name<span class="font-bold text-highlight">*</span></label>
                            <p class="text-xs text-body mb-sm">This is how your name will be displayed on your badge and online event signups</p>                            
                            <input type="" id="pronouns" name="pronouns" value="" :value="user && user.pronouns">
                        </div>
                        <div>
                            <label for="userNicename" class="text-xs uppercase">Pronouns<span class="font-bold text-highlight">*</span></label>
                            <p class="text-xs text-body mb-sm">This is how your name will be displayed on your badge and online event signups</p>                            
                            <input type="" id="pronouns" name="pronouns" value="" :value="user && user.pronouns">
                        </div>
                        <div>
                            <label for="userNicename" class="text-xs uppercase">Discord handle<span class="font-bold text-highlight">*</span></label>
                            <p class="text-xs text-body mb-sm">Go Play NW Online events are hosted on Go Play NW's community Discord server. A Discord account is required to participate.</p>
                            <input type="" id="discordHandle" name="discordHandle" value="" :value="user && user.discord">
                        </div>
                    </fieldset>
                    <div data-netlify-recaptcha="true"></div>
                    <p class="mt-base">
                        <button type="submit">Save</button>
                    </p>                        
                    </form>
                {# // TODO: add communication prefrences #}
                {# Volunteer Preferences #}
                    <form x-cloak x-show="isVolunteer" 
                    data-netlify="true" 
                    netlify-honeypot="bot-field"
                    data-netlify-recaptcha="true"
                    method="POST" 
                    name="attendee-profile"  
                    action="/create-account-thank-you"
                    >
                    <fieldset>
                        <legend>Volunteer Preferences</legend>
                        <span>This section is only valid if they have the volunteer role, and will mainly be used for managing volunteer contact details.</span>
                        <div>
                            <label for="userPhone" class="text-xs uppercase">Email<span class="font-bold text-highlight">*</span></label>
                            <p class="text-xs text-body mb-sm">Your goplaynw.org account email address is used for all volunteer-related email communication. To change your account's email address, see Account Settings.</p>
                            <span x-text="user && user.userEmail" ></span>
                        </div>
                        <div>
                            <label for="userPhone" class="text-xs uppercase">Phone Number<span class="font-bold text-highlight">*</span></label>
                            <p class="text-xs text-body mb-sm">A valid phone number is required so that we can contact you in case of emergencies.</p>
                            <input type="" id="userPhone" name="userPhone" value="" :value="user && user.userPhone">
                        </div>
                        <div>
                            <label for="userVolunteerRoles" class="text-xs uppercase">Preferred Volunteer Roles <span class="font-bold text-highlight">*</span></label>
                            <p class="text-xs text-body mb-sm">This section should display a list of volunteer roles. Invite-only volunteer roles should be displayed, but disabled unless the volunteer has the appropriate role setting.</p>
                            <input type="" id="userVolunteerRoles" name="userVolunteerRoles" value="" :value="user && user.userEmail">
                        </div>
                    </fieldset>
                    <div data-netlify-recaptcha="true"></div>
                    <p class="mt-base">
                        <button type="submit">Save</button>
                    </p>                    
                    </form>
                    <div x-show="!isVolunteer"> Not a volunteer. become one now.
                    </div>                        
            </section>
        </div>
    </main>
{% endblock %}

{# user	{"value":{"id":493,"userNicename":"colinaut","userEmail":"colin.fahrion@gmail.com","userUrl":"","userRegistered":1347009101000,"displayName":"Colin Fahrion","bookingComment":null,"lastUpdated":null,"metadata":[{"umetaId":64878,"metaKey":"facebook","metaValue":"","userId":493},{"umetaId":7740,"metaKey":"first_name","metaValue":"Colin","userId":493},{"umetaId":7741,"metaKey":"last_name","metaValue":"Fahrion","userId":493},{"umetaId":7742,"metaKey":"nickname","metaValue":"colinaut","userId":493},{"umetaId":64882,"metaKey":"parentemail","metaValue":"","userId":493},{"umetaId":64881,"metaKey":"parentname","metaValue":"","userId":493},{"umetaId":64879,"metaKey":"twitter","metaValue":"@colinaut","userId":493},{"umetaId":85774,"metaKey":"wp_[prefix]_capabilities","metaValue":"a:2:{s:13:\"administrator\";b:1;s:5:\"staff\";b:1;}","userId":493}],"bbcUserFavorites":[{"bbcUserFavoritesId":7987,"userId":493,"eventId":2659,"createDate":1568848882000,"updateDate":1568848882000,"status":1},{"bbcUserFavoritesId":7998,"userId":493,"eventId":2547,"createDate":1568863479000,"updateDate":1568863479000,"status":1},{"bbcUserFavoritesId":8521,"userId":493,"eventId":2845,"createDate":1628183203000,"updateDate":1628183203000,"status":1}]},"expiry":1628910026402} #}

