var lilRed=(()=>{var u=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var T=(e,t)=>{for(var o in t)u(e,o,{get:t[o],enumerable:!0})},k=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of w(t))!I.call(e,s)&&s!==o&&u(e,s,{get:()=>t[s],enumerable:!(r=S(t,s))||r.enumerable});return e};var A=e=>k(u({},"__esModule",{value:!0}),e);var q={};T(q,{admin:()=>G,bookings:()=>D,events:()=>_,favorites:()=>F,fetcher:()=>y,init:()=>L,isAdmin:()=>P,lilDelete:()=>f,lilFetch:()=>i,lilGet:()=>l,lilPost:()=>a,lilPut:()=>b,login:()=>$,logout:()=>R,me:()=>U,password:()=>j,status:()=>O});var N={lilRedApiUrl:null,logoutIfStale:!0,daysTillLogout:10},n,p="lilRedAuthToken",m="lilRedLastLogin";function d(e,t,o=!0){typeof t=="string"&&/^ERROR/.test(t)?console.error(e,t):console.log(e,t),document.dispatchEvent(new CustomEvent(e,{bubbles:o,detail:t}))}async function y(e,t){try{let o=await fetch(e,t);if(console.log(`RESPONSE:lilFetch for ${e}`,o),o.status!==200)throw new Error(`fetch fail status: ${o.status}`);let r=o.headers.get("content-type"),s=r&&r.indexOf("application/json")!==-1?await o.json():await o.text();return console.log(`RESULT:lilFetch for ${e}`,s),s}catch(o){return console.error(`ERROR:lilFetch for ${e}`,o),null}}async function E(e,t){if(!n&&n.lilRedApiUrl)return!1;let o=n.lilRedApiUrl+"/login",r={method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({username:e,password:t})};try{let s=await fetch(o,r);if(s.status===200&&s.headers.get("authorization")){let c=s.headers.get("authorization");return localStorage.setItem(p,c),localStorage.setItem(m,new Date().toISOString()),d("lilRed_login","success"),c}}catch{return d("lilRed_login","fail"),null}}async function i(e){if(e={jsonStringify:!0,method:"GET",...e},!n&&n.lilRedApiUrl||!n.lilRedApiUrl||!e.api)return!1;let t=n.lilRedApiUrl+e.api,o={method:e.method,headers:{}};if(e.jsonStringify&&(e.body=e.body&&JSON.stringify(e.body),o.headers["Content-Type"]="application/json;charset=utf-8"),e.body&&(o.body=e.body),e.api!=="/"&&!/public/.test(e.api)){let s=e.token||n.token||localStorage.getItem(p);if(s)o.headers.Authorization=s;else return d("lilRed_lilFetch","ERROR: auth token missing"),null;if(n.logoutIfStale){let c=Date.parse(localStorage.getItem(m)),g=new Date,v=n.daysTillLogout||10,h=Date.parse(new Date(g.setDate(g.getDate()-v)));if(isNaN(c)||isNaN(h)||c<h)return d("lilRed_lilFetch",`ERROR: auth token stale. Last Login: ${c}`),R(),null}o.headers.Authorization=s}return await y(t,o)}var l=(e,t)=>i({api:e,token:t}),a=(e,t,o)=>i({api:e,method:"POST",body:t,token:o}),b=(e,t,o)=>i({api:e,method:"PUT",body:t,token:o}),f=(e,t,o)=>i({api:e,method:"DELETE",body:t,token:o});function L(e){n={...N,...e},console.log("\u{1F43A} Initializing Lil Red Fetch",n)}var O=async()=>{let e=await l("/");return d("lilRed_status",e),e},P=()=>l("/users/me/isadmin"),$=(e,t)=>E(e,t),R=()=>{d("lilRed_logout","You have been logged out of Lil Red"),localStorage.removeItem(p),localStorage.removeItem(m)},U=()=>l("/users/me"),D={slots:()=>l("/bookings/myAvailableSlots"),get:()=>l("/events/me"),add:e=>a("/bookings/bookMeIntoGame",{gameId:Number(e)}),delete:e=>f("/bookings/removeMeFromGame",{gameId:Number(e)})},F={get:()=>l("/events/me/favorites"),add:e=>a("/events/me/favorite/create",{eventId:Number(e)}),delete:e=>f("/events/me/favorite/delete",{eventId:Number(e)})},j={set:(e,t)=>a("/users/setMyPassword",{userId:Number(e),password:t}),resetRequest:e=>a("/users/resetPasswordRequest",{email:e}),request:(e,t,o)=>a("/password/request",{emailAddress:e,emailBody:t,emailSubject:o}),reset:(e,t,o)=>a("/password/reset",{emailAddress:e,password:t,uuid:o}),confirm:(e,t)=>a("/users/confirmPasswordRequest",{password:e,token:t})},_={me:()=>l("/events/me"),spaces:()=>l("/events/spaces/public"),space:e=>l(`/events/${e}/spaces/public`),find:e=>a("/events/find",{id:Number(e)}),all:()=>l("/events/all"),category:e=>l(`/events/category/${e}`),count:()=>l("/events/count"),create:e=>b("/users/setMyPassword",e),uploadImage:e=>{i({api:"/events/image",method:"POST",body:e,jsonStringify:!1})},currentYear:(e,t)=>l(`/events/page/${e}/${t}`),since:e=>l(`/events/since/${e}`),public:{all:()=>i("/events/all/public"),currentYear:(e,t)=>l(`/events/page/public/${e}/${t}`)}},G={roles:{add:(e,t)=>a("/events/addRoleToUser",{userId:Number(e),role:t}),delete:(e,t)=>a("/events/removeRoleFormUser",{userId:Number(e),role:t})},users:{all:()=>{},create:()=>{},findById:()=>{},findByEmail:()=>{},setPassword:()=>{}},bookings:{add:()=>{},delete:()=>{},setGm:()=>{}}};return A(q);})();
//# sourceMappingURL=lil-red.min.js.map
