var lilRed=(()=>{var u=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var T=(e,t)=>{for(var o in t)u(e,o,{get:t[o],enumerable:!0})},k=(e,t,o,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of w(t))!I.call(e,s)&&s!==o&&u(e,s,{get:()=>t[s],enumerable:!(a=S(t,s))||a.enumerable});return e};var A=e=>k(u({},"__esModule",{value:!0}),e);var x={};T(x,{admin:()=>q,bookings:()=>D,events:()=>G,favorites:()=>j,fetcher:()=>y,init:()=>L,isAdmin:()=>P,lilDelete:()=>f,lilFetch:()=>i,lilGet:()=>l,lilPost:()=>r,lilPut:()=>b,login:()=>$,logout:()=>R,me:()=>U,password:()=>F,status:()=>O});var N={lilRedApiUrl:null,logoutIfStale:!0,daysTillLogout:10},n,p="lilRedAuthToken",m="lilRedLastLogin";function d(e,t,o=!0){typeof t=="string"&&/^ERROR/.test(t)?console.error(e,t):console.log(e,t),document.dispatchEvent(new CustomEvent(e,{bubbles:o,detail:t}))}async function y(e,t){try{let o=await fetch(e,t);if(console.log(`RESPONSE:lilFetch for ${e}`,o),o.status!==200)throw new Error(`fetch fail status: ${o.status}`);let a=o.headers.get("content-type"),s=a&&a.indexOf("application/json")!==-1?await o.json():await o.text();return console.log(`RESULT:lilFetch for ${e}`,s),s}catch(o){return console.error(`ERROR:lilFetch for ${e}`,o),null}}async function E(e,t){if(!n&&n.lilRedApiUrl)return!1;let o=n.lilRedApiUrl+"/login",a={method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({username:e,password:t})};try{let s=await fetch(o,a);if(s.status===200&&s.headers.get("authorization")){let c=s.headers.get("authorization");return localStorage.setItem(p,c),localStorage.setItem(m,new Date().toISOString()),d("lilRed:login","success"),c}}catch{return d("lilRed:login","fail"),null}}async function i(e){if(e={jsonStringify:!0,method:"GET",...e},!n&&n.lilRedApiUrl||!n.lilRedApiUrl||!e.api)return!1;let t=n.lilRedApiUrl+e.api,o={method:e.method,headers:{}};if(e.jsonStringify&&(e.body=e.body&&JSON.stringify(e.body),o.headers["Content-Type"]="application/json;charset=utf-8"),e.body&&(o.body=e.body),e.api!=="/"&&!/public/.test(e.api)){let s=e.token||n.token||localStorage.getItem(p);if(s)o.headers.Authorization=s;else return d("lilRed:fetch-error","ERROR: auth token missing"),null;if(n.logoutIfStale){let c=Date.parse(localStorage.getItem(m)),g=new Date,v=n.daysTillLogout||10,h=Date.parse(new Date(g.setDate(g.getDate()-v)));if(isNaN(c)||isNaN(h)||c<h)return d("lilRed:fetch-error",`ERROR: auth token stale. Last Login: ${c}`),R(),null}o.headers.Authorization=s}return await y(t,o)}var l=(e,t)=>i({api:e,token:t}),r=(e,t,o)=>i({api:e,method:"POST",body:t,token:o}),b=(e,t,o)=>i({api:e,method:"PUT",body:t,token:o}),f=(e,t,o)=>i({api:e,method:"DELETE",body:t,token:o});function L(e){n={...N,...e},console.log("\u{1F43A} Initializing Lil Red Fetch",n)}var O=async()=>{let e=await l("/");return d("lilRed:status",e),e},P=()=>l("/users/me/isadmin"),$=(e,t)=>E(e,t),R=()=>{d("lilRed:logout","You have been logged out of Lil Red"),localStorage.removeItem(p),localStorage.removeItem(m)},U=()=>l("/users/me"),D={slots:()=>l("/bookings/myAvailableSlots"),get:()=>l("/events/me"),add:e=>r("/bookings/bookMeIntoGame",{gameId:Number(e)}),delete:e=>f("/bookings/removeMeFromGame",{gameId:Number(e)})},j={get:()=>l("/events/me/favorites"),add:e=>r("/events/me/favorite/create",{eventId:Number(e)}),delete:e=>f("/events/me/favorite/delete",{eventId:Number(e)})},F={set:(e,t)=>r("/users/setMyPassword",{userId:Number(e),password:t}),resetRequest:e=>r("/users/resetPasswordRequest",{email:e}),request:(e,t,o)=>r("/password/request",{emailAddress:e,emailBody:t,emailSubject:o}),reset:(e,t,o)=>r("/password/reset",{emailAddress:e,password:t,uuid:o}),confirm:(e,t)=>r("/users/confirmPasswordRequest",{password:e,token:t})},G={me:()=>l("/events/me"),spaces:()=>l("/events/spaces/public"),space:e=>l(`/events/${e}/spaces/public`),find:e=>r("/events/find",{id:Number(e)}),all:()=>l("/events/all"),category:e=>l(`/events/category/${e}`),count:()=>l("/events/count"),create:e=>b("/users/setMyPassword",e),uploadImage:e=>i({api:"/events/image",method:"POST",body:e,jsonStringify:!0}),currentYear:(e,t)=>l(`/events/page/${e}/${t}`),since:e=>l(`/events/since/${e}`),public:{all:()=>i("/events/all/public"),currentYear:(e,t)=>l(`/events/page/public/${e}/${t}`)}},q={roles:{add:(e,t)=>r("/events/addRoleToUser",{userId:Number(e),role:t}),delete:(e,t)=>r("/events/removeRoleFormUser",{userId:Number(e),role:t})},users:{all:()=>{},create:()=>{},findById:()=>{},findByEmail:()=>{},setPassword:()=>{}},bookings:{add:()=>{},delete:()=>{},setGm:()=>{}}};return A(x);})();
//# sourceMappingURL=lil-red.min.js.map
